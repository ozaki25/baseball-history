# 観戦履歴アプリ

北海道日本ハムファイターズの観戦記録を管理するPWA（Progressive Web App）です。

## 🏟️ 機能

- **観戦履歴管理**: 試合日程、対戦相手、結果、スコア、球場、メモを記録
- **年度別フィルタリング**: 年度を選択して観戦履歴を絞り込み
- **統計表示**: 総観戦数、勝利数、敗戦数、勝率を表示
- **レスポンシブデザイン**: モバイル・タブレット・デスクトップに最適化
- **PWA対応**: デスクトップにインストール可能、オフライン対応
- **アクセシビリティ**: WCAG 2.1 AA準拠、スクリーンリーダー対応

## 🎨 デザイン

- **ファイターズカラー**: 公式ブランドカラーを使用
  - プライマリブルー: `#006298`
  - ゴールド: `#b3a369`
  - ブラック: `#010101`
  - ホワイト: `#ffffff`

## 🛠️ 技術スタック

- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **PWA**: Service Worker、Web App Manifest
- **アクセシビリティ**: ARIA、セマンティックHTML
- **デプロイ**: Vercel

## 📱 PWA機能

- **インストール**: ブラウザから直接アプリをインストール
- **オフライン対応**: インターネット接続なしでも基本機能を利用可能
- **ネイティブ風UI**: モバイルアプリのような操作感

## 🚀 開発

```bash
# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev

# プロダクションビルド
npm run build

# プロダクションサーバーを起動
npm start
```

## 📂 プロジェクト構造

```
src/
  app/           # Next.js App Router
  components/    # Reactコンポーネント
  lib/
    parsers/     # HTML解析モジュール（リファクタリング済み）
      teamExtractor.ts      # チーム情報抽出
      scoreExtractor.ts     # スコア情報抽出
      venueExtractor.ts     # 会場情報抽出
      homeVisitorDetector.ts # ホーム/ビジター判定
      gameParser.ts         # メイン解析ロジック
      index.ts              # エクスポートまとめ
    gameDataFetcher.ts      # メインスクレイピング機能
  types/
    game.ts               # ゲーム関連の型定義
    parsing.ts            # HTML解析用の型定義
data/           # JSONデータファイル
public/         # 静的ファイル、PWA関連
```

## 🔧 HTML解析システム（リファクタリング済み）

HTMLからの試合データ抽出を大幅にリファクタリングし、保守性とテスタビリティを向上させました：

### 📋 主要な改善点

- **機能分割**: 抽出機能を責任ごとに個別モジュールに分離
- **型安全性**: TypeScriptによる厳密な型定義
- **エラーハンドリング**: 詳細なエラー情報とフォールバック戦略
- **DOM解析**: 文字列検索からDOMベース解析に移行（JSDOM使用）
- **複数判定方式**: チーム位置と会場情報による冗長なホーム/ビジター判定

### 🎯 モジュール構成

- **`teamExtractor`**: 対戦相手チーム名とファイターズの位置検出
- **`scoreExtractor`**: 試合スコアと勝敗判定、試合ステータス（中止/延期）検出
- **`venueExtractor`**: 試合会場の抽出とホーム球場判定
- **`homeVisitorDetector`**: 複数手法による信頼性の高いホーム/ビジター判定
- **`gameParser`**: 全機能を統合したメイン解析エンジン

### 🛡️ エラーハンドリング戦略

- **カスタムエラー**: `ParseError`クラスによる構造化エラー情報
- **段階的フォールバック**: 一次手法失敗時の代替解析方法
- **デフォルト値除去**: エラーの可視性向上のためデフォルト値を削除
- **詳細ログ**: デバッグ用の詳細なコンソール出力

## 🎯 主要コンポーネント

- **GameTable**: 観戦履歴テーブル（デスクトップ）・カード（モバイル）
- **StatsCards**: 統計情報カード
- **YearSelector**: 年度選択プルダウン
- **Header/Footer**: ナビゲーションとフッター

## ♿ アクセシビリティ対応

- **WCAG 2.1 AA準拠**: コントラスト比、フォーカス管理
- **キーボードナビゲーション**: タブキーでの操作
- **スクリーンリーダー**: ARIA属性、セマンティックHTML
- **多言語対応**: 日本語UI

## 📄 ライセンス

MIT License
